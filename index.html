<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mã Hóa Đa Code - Hỗ Trợ Đa Ngôn Ngữ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #007bff;
            margin-bottom: 30px;
        }
        .form-label {
            font-weight: bold;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            background-color: #f1f1f1;
            border-radius: 5px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .btn-primary {
            background-color: #007bff;
            border: none;
        }
        .btn-secondary {
            background-color: #6c757d;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mã Hóa Đa Code</h1>
        <form>
            <div class="mb-3">
                <label for="inputText" class="form-label">Nhập văn bản:</label>
                <textarea class="form-control" id="inputText" rows="4" placeholder="Nhập văn bản để mã hóa/giải mã"></textarea>
            </div>
            <div class="mb-3">
                <label for="method" class="form-label">Chọn phương pháp:</label>
                <select class="form-select" id="method">
                    <option value="caesar">Caesar Cipher (shift = 3)</option>
                    <option value="vigenere">Vigenère Cipher (key = "key")</option>
                    <option value="base64">Base64</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="language" class="form-label">Chọn ngôn ngữ:</label>
                <select class="form-select" id="language">
                    <option value="js">JavaScript (Thực thi trực tiếp)</option>
                    <option value="python">Python</option>
                    <option value="java">Java</option>
                    <option value="lua">Lua</option>
                </select>
            </div>
            <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                <button type="button" class="btn btn-primary" onclick="processText('encode')">Mã Hóa</button>
                <button type="button" class="btn btn-secondary" onclick="processText('decode')">Giải Mã</button>
            </div>
        </form>
        <div id="output"></div>
    </div>

    <script>
        function caesarCipherJS(text, encode = true) {
            const shift = 3; // Khóa mặc định cho Caesar
            let adjustedShift = encode ? shift : -shift;
            return text.replace(/[a-zA-Z]/g, char => {
                let code = char.charCodeAt(0);
                let base = code >= 65 && code <= 90 ? 65 : 97;
                return String.fromCharCode(((code - base + adjustedShift) % 26 + 26) % 26 + base);
            });
        }

        function vigenereCipherJS(text, encode = true) {
            const key = "key"; // Khóa mặc định cho Vigenère
            let adjustedKey = key.toLowerCase().replace(/[^a-z]/g, '');
            let result = '';
            let keyIndex = 0;
            for (let i = 0; i < text.length; i++) {
                let char = text[i];
                if (/[a-zA-Z]/.test(char)) {
                    let shift = adjustedKey.charCodeAt(keyIndex % adjustedKey.length) - 97;
                    if (!encode) shift = -shift;
                    let code = char.charCodeAt(0);
                    let base = code >= 65 && code <= 90 ? 65 : 97;
                    result += String.fromCharCode(((code - base + shift) % 26 + 26) % 26 + base);
                    keyIndex++;
                } else {
                    result += char;
                }
            }
            return result;
        }

        function base64JS(text, encode = true) {
            try {
                if (encode) {
                    return btoa(encodeURIComponent(text).replace(/%([0-9A-F]{2})/g, function(match, p1) {
                        return String.fromCharCode(parseInt(p1, 16));
                    }));
                } else {
                    return decodeURIComponent(Array.prototype.map.call(atob(text), function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                }
            } catch (e) {
                return 'Lỗi: Văn bản không hợp lệ cho Base64';
            }
        }

        function generatePythonCode(method, mode) {
            let encode = mode === 'encode';
            let funcName = encode ? 'encode' : 'decode';
            let textVar = 'text';
            const shift = 3; // Khóa mặc định cho Caesar
            const key = "key"; // Khóa mặc định cho Vigenère

            if (method === 'caesar') {
                return `
def caesar_cipher(text, shift=${shift}, encode=${encode}):
    if not encode:
        shift = -shift
    result = ''
    for char in text:
        if char.isalpha():
            base = ord('A') if char.isupper() else ord('a')
            result += chr((ord(char) - base + shift) % 26 + base)
        else:
            result += char
    return result

# Sử dụng:
${textVar} = "your_text_here"
print(caesar_cipher(${textVar}))
`;
            } else if (method === 'vigenere') {
                return `
def vigenere_cipher(text, key="${key}", encode=${encode}):
    key = ''.join([c.lower() for c in key if c.isalpha()])
    result = ''
    key_index = 0
    for char in text:
        if char.isalpha():
            shift = ord(key[key_index % len(key)]) - ord('a')
            if not encode:
                shift = -shift
            base = ord('A') if char.isupper() else ord('a')
            result += chr((ord(char) - base + shift) % 26 + base)
            key_index += 1
        else:
            result += char
    return result

# Sử dụng:
${textVar} = "your_text_here"
print(vigenere_cipher(${textVar}))
`;
            } else if (method === 'base64') {
                return `
import base64

def base64_${funcName}(text):
    if ${encode}:
        return base64.b64encode(text.encode('utf-8')).decode('utf-8')
    else:
        return base64.b64decode(text.encode('utf-8')).decode('utf-8')

# Sử dụng:
${textVar} = "your_text_here"
print(base64_${funcName}(${textVar}))
`;
            }
        }

        function generateJavaCode(method, mode) {
            let encode = mode === 'encode';
            let funcName = encode ? "Encode" : "Decode";
            let textVar = "text";
            const shift = 3; // Khóa mặc định cho Caesar
            const key = "key"; // Khóa mặc định cho Vigenère

            if (method === 'caesar') {
                return `
import java.nio.charset.StandardCharsets;

public class CaesarCipher {
    public static String caesarCipher(String text, int shift, boolean encode) {
        if (!encode) shift = -shift;
        StringBuilder result = new StringBuilder();
        for (char chara : text.toCharArray()) {
            if (Character.isLetter(chara)) {
                char base = Character.isUpperCase(chara) ? 'A' : 'a';
                result.append((char) (((chara - base + shift) % 26 + 26) % 26 + base));
            } else {
                result.append(chara);
            }
        }
        return result.toString();
    }

    public static void main(String[] args) {
        String ${textVar} = "your_text_here";
        int shift = ${shift};
        System.out.println(caesarCipher(${textVar}, shift, ${encode}));
    }
}
`;
            } else if (method === 'vigenere') {
                return `
import java.nio.charset.StandardCharsets;

public class VigenereCipher {
    public static String vigenereCipher(String text, String key, boolean encode) {
        key = key.toLowerCase().replaceAll("[^a-z]", "");
        StringBuilder result = new StringBuilder();
        int keyIndex = 0;
        for (char chara : text.toCharArray()) {
            if (Character.isLetter(chara)) {
                int shift = key.charAt(keyIndex % key.length()) - 'a';
                if (!encode) shift = -shift;
                char base = Character.isUpperCase(chara) ? 'A' : 'a';
                result.append((char) (((chara - base + shift) % 26 + 26) % 26 + base));
                keyIndex++;
            } else {
                result.append(chara);
            }
        }
        return result.toString();
    }

    public static void main(String[] args) {
        String ${textVar} = "your_text_here";
        String key = "${key}";
        System.out.println(vigenereCipher(${textVar}, key, ${encode}));
    }
}
`;
            } else if (method === 'base64') {
                return `
import java.util.Base64;
import java.nio.charset.StandardCharsets;

public class Base64${funcName} {
    public static String base64${funcName}(String text) {
        if (${encode}) {
            return Base64.getEncoder().encodeToString(text.getBytes(StandardCharsets.UTF_8));
        } else {
            return new String(Base64.getDecoder().decode(text), StandardCharsets.UTF_8);
        }
    }

    public static void main(String[] args) {
        String ${textVar} = "your_text_here";
        System.out.println(base64${funcName}(${textVar}));
    }
}
`;
            }
        }

        function generateLuaCode(method, mode) {
            let encode = mode === 'encode';
            let funcName = encode ? 'encode' : 'decode';
            let textVar = 'text';
            const shift = 3; // Khóa mặc định cho Caesar
            const key = "key"; // Khóa mặc định cho Vigenère

            if (method === 'caesar') {
                return `
function caesar_cipher(text, shift, encode)
    if not encode then shift = -shift end
    local result = ""
    for i = 1, #text do
        local char = text:sub(i,i)
        local code = string.byte(char)
        if code >= 65 and code <= 90 then
            result = result .. string.char(((code - 65 + shift) % 26 + 26) % 26 + 65)
        elseif code >= 97 and code <= 122 then
            result = result .. string.char(((code - 97 + shift) %  26 + 26) % 26 + 97)
        else
            result = result .. char
        end
    end
    return result
end

-- Sử dụng:
${textVar} = "your_text_here"
shift = ${shift}
print(caesar_cipher(${textVar}, shift, ${encode}))
`;
            } else if (method === 'vigenere') {
                return `
function vigenere_cipher(text, key, encode)
    key = key:lower():gsub("[^a-z]", "")
    local result = ""
    local key_index = 1
    for i = 1, #text do
        local char = text:sub(i,i)
        local code = string.byte(char)
        if (code >= 65 and code <= 90) or (code >= 97 and code <= 122) then
            local shift = string.byte(key:sub(key_index % #key + 1, key_index % #key + 1)) - 97
            if not encode then shift = -shift end
            local base = (code >= 65 and code <= 90) and 65 or 97
            result = result .. string.char(((code - base + shift) % 26 + 26) % 26 + base)
            key_index = key_index + 1
        else
            result = result .. char
        end
    end
    return result
end

-- Sử dụng:
${textVar} = "your_text_here"
key = "${key}"
print(vigenere_cipher(${textVar}, key, ${encode}))
`;
            } else if (method === 'base64') {
                return `
-- Lua không có thư viện Base64 tích hợp. Dưới đây là triển khai thủ công:

local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'

function base64_encode(data)
    return ((data:gsub('.', function(x) 
        local r, byte = '', x:byte()
        for i = 8,1,-1 do r = r .. (byte % 2^i - byte % 2^(i-1) > 0 and '1' or '0') end
        return r
    end)..'0000'):gsub('%d%d%d?%d?%d?%d?', function(x)
        if (#x < 6) then return '' end
        local c = 0
        for i = 1, 6 do c = c + (x:sub(i,i) == '1' and 2^(6 - i) or 0) end
        return b:sub(c + 1, c + 1)
    end)..({ '', '==', '=' })[#data % 3 + 1])
end

function base64_decode(data)
    data = string.gsub(data, '[^'..b..'=]', '')
    return (data:gsub('.', function(x)
        if (x == '=') then return '' end
        local r, f = '', (b:find(x) - 1)
        for i = 6,1,-1 do r = r .. (f % 2^i - f % 2^(i-1) > 0 and '1' or '0') end
        return r
    end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
        if (#x ~= 8) then return '' end
        local c = 0
        for i = 1, 8 do c = c + (x:sub(i,i) == '1' and 2^(8 - i) or 0) end
        return string.char(c)
    end))
end

-- Sử dụng:
${textVar} = "your_text_here"
if ${encode} then
    print(base64_encode(${textVar}))
else
    print(base64_decode(${textVar}))
end
`;
            }
        }

        function processText(mode) {
            const input = document.getElementById('inputText').value;
            const method = document.getElementById('method').value;
            const language = document.getElementById('language').value;
            const outputDiv = document.getElementById('output');
            let result = '';

            if (!input) {
                outputDiv.innerHTML = '<strong>Lỗi:</strong> Vui lòng nhập văn bản!';
                return;
            }

            try {
                if (language === 'js') {
                    if (method === 'caesar') {
                        result = caesarCipherJS(input, mode === 'encode');
                    } else if (method === 'vigenere') {
                        result = vigenereCipherJS(input, mode === 'encode');
                    } else if (method === 'base64') {
                        result = base64JS(input, mode === 'encode');
                    }
                    outputDiv.innerHTML = `<strong>Kết quả:</strong> ${result}`;
                } else if (language === 'python') {
                    result = generatePythonCode(method, mode);
                    outputDiv.innerHTML = `<strong>Code Python:</strong><pre><code>${result.replace(/your_text_here/g, input)}</code></pre>`;
                } else if (language === 'java') {
                    result = generateJavaCode(method, mode);
                    outputDiv.innerHTML = `<strong>Code Java:</strong><pre><code>${result.replace(/your_text_here/g, input)}</code></pre>`;
                } else if (language === 'lua') {
                    result = generateLuaCode(method, mode);
                    outputDiv.innerHTML = `<strong>Code Lua:</strong><pre><code>${result.replace(/your_text_here/g, input)}</code></pre>`;
                }
            } catch (e) {
                outputDiv.innerHTML = '<strong>Lỗi:</strong> Đã xảy ra lỗi trong quá trình xử lý: ' + e.message;
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
